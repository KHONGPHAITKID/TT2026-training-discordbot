# Daily Computer Science Quiz Bot

An educational Discord bot that delivers daily multiple-choice computer science questions, tracks answers, awards points, and shares visual performance summaries. Questions are generated dynamically through the Groq LLM API with a local fallback library for offline development.

## Features
- Automated daily question posting (configurable schedule and channel).
- Manual `/question` (alias `/q`) command to request fresh prompts on demand.
- `/tt` shortcut panel with buttons for common quiz actions.
- Message-based answers (A/B/C/D) with first-correct-wins scoring.
- Questions rotate through easy, medium, and hard levels, with difficulty shown on each prompt.
- Generated by randomly selected Groq models (model name shown on each question).
- Persistent leaderboard and per-user stats stored in SQLite via SQLAlchemy.
- Rich personal & global stat visualisations (accuracy, topic mastery, consistency leaders).
- Admin utilities to set quiz channels, assign admin roles, reset scores, and force new questions.

## Project Layout
```
bot.py                 # Bot entrypoint
cogs/                  # Discord command and event handlers
services/              # Database, Groq API, charting utilities
data/                  # SQLite database and generated chart assets
```

## Getting Started
1. **Install dependencies**
   ```bash
   python -m venv .venv
   source .venv/bin/activate  # Windows: .venv\Scripts\activate
   pip install -r requirements.txt
   ```

2. **Create a `.env` file**
   ```ini
   DISCORD_TOKEN=your_discord_bot_token

   # LLM Provider API Keys (optional - configure which to use in models.json)
   GROQ_API_KEY=optional_groq_token
   OPENAI_API_KEY=optional_openai_token

   # Scheduling
   DAILY_QUESTION_CRON=0 0 * * *      # optional cron expression (default is 07:00 UTC+7)
   BOT_TIMEZONE=Asia/Bangkok          # optional timezone for scheduler (default UTC+7)
   ```

3. **Run the bot**
   ```bash
   python bot.py
   ```

## Commands Overview
- `/question [topic]` (alias `/q`) - post a fresh question immediately.
- Tap the answer buttons (or type `A/B/C/D`) to respond; first correct reply wins and ends the round.
- `/show_question` - re-display the latest question embed.
- `/leaderboard` - show the top scorers (includes chart).
- `/leaderboard` now also surfaces accuracy leaders and topic specialists.
- `/stats [member]` - display stats and history for a user.
- `/ans` - reveal the most recent question's answer and explanation.
- `/recent_questions` - list the latest topics asked.
- `/tt` - open quick-action buttons for new question, stats, leaderboard.
- `/tthelp` - show command reference and usage tips.
- Admin-only: `/set_daily_channel`, `/set_admin_role`, `/reset_scores`.

## Configuration Files

The bot uses JSON configuration files for easy customization without code changes.

### Topics Configuration (`topics.json`)

Control which quiz topics are available:

```json
{
  "categories": {
    "algorithms_and_data_structures": {
      "display_name": "Algorithms & Data Structures",
      "enabled": true,
      "topics": [
        "Algorithms & Data Structures",
        "Sorting Algorithms",
        "Graph Algorithms"
      ]
    }
  }
}
```

- **Add topics**: Add entries to any category's `topics` array
- **Remove topics**: Delete unwanted topic strings
- **Disable categories**: Set `"enabled": false` to exclude all topics in a category
- Topics are randomly selected from all enabled categories

### LLM Provider Configuration (`models.json`)

The bot uses `models.json` to configure LLM providers and models. This allows easy addition of new providers (OpenAI, Anthropic, etc.) without code changes.

#### Configuration Structure

```json
{
  "providers": {
    "groq": {
      "enabled": true,
      "api_key_env": "GROQ_API_KEY",
      "models": ["openai/gpt-oss-120b", "openai/gpt-oss-20b", "llama-3.3-70b-versatile"]
    },
    "openai": {
      "enabled": false,
      "api_key_env": "OPENAI_API_KEY",
      "models": ["gpt-4o-mini", "gpt-4o"]
    }
  },
  "settings": {
    "max_retries": 3,
    "temperature": 0.7,
    "max_tokens": 512
  }
}
```

#### Adding OpenAI Provider

To enable OpenAI alongside Groq:

1. **Install dependencies** (if not already done):
   ```bash
   pip install -r requirements.txt
   ```

2. **Add your OpenAI API key to `.env`**:
   ```ini
   OPENAI_API_KEY=sk-your-actual-api-key-here
   ```

3. **Enable OpenAI in `models.json`**:
   ```json
   "openai": {
     "enabled": true,
     "api_key_env": "OPENAI_API_KEY",
     "base_url": "https://api.openai.com/v1",
     "models": ["gpt-4o-mini", "gpt-4o"]
   }
   ```

4. **Restart the bot** - it will automatically use models from both providers

The bot will randomly select from all enabled provider models. If a model fails, it will automatically retry with a different model (which could be from a different provider).

#### Multi-Provider Benefits

- **Redundancy**: If one provider is down, automatically uses another
- **Cost Optimization**: Mix expensive and cheap models (e.g., use GPT-4o-mini first, GPT-4o as backup)
- **Quality Comparison**: Use multiple providers to compare question quality
- **Rate Limit Handling**: Spread requests across providers to avoid rate limits

#### Retry Logic

- Bot randomly selects from all enabled provider models
- On failure, automatically retries with different models (max 3 attempts by default)
- Each retry can use a completely different provider (e.g., try Groq → OpenAI → Groq)
- Falls back to curated local questions if all attempts fail

## Development Notes
- SQLite is used by default; set `DATABASE_URL` for PostgreSQL or another backend.
- Matplotlib charts save to `data/charts/`. The bot automatically attaches these images when available.
- Configuration files:
  - `topics.json` - Quiz topics organized by category (add/remove topics as needed)
  - `models.json` - LLM providers and models (supports Groq, OpenAI, Anthropic, etc.)
- The LLM client supports multiple providers with automatic retry logic across different models.

## Roadmap Ideas
- Emoji reaction answering workflow.
- Difficulty levels and topic filters.
- Weekly summary posts and external dashboard integration.


